<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Cellular Automata executor</title>
<style type="text/css" media="screen">
	body{
		background:#DDD;
	}
	#editor { 
		margin: 2;
		height:200px;
		top: 0;
		bottom: 0;
		left: 0;
		right: 0;
	}
	#console { 
		overflow:auto;
		height:200px;
		background:#EEE;
		font-size: 60%;
	}
	
</style>
</head>
<body>
<span id ="hint">Write Automata JSON description code inside the editor to change it live:</span><br/>
<canvas id="target_canvas" width="600" height="400">
</canvas>
<div id="console"></div><br />
<span id="status"></span>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="AONInterpreter.js"></script>

<pre id="editor">{
"comment":"the Stephen Wolfram's rule 30 automa",
"cells":[
	{"x":150,"y":10,"status":"active cell","timerange":[1,10]},
	{"x":110,"y":10,"status":"active cell","timerange":[1,10]},
	{"x":130,"y":180,"status":"active cell","timerange":[1,10]}
],
"palette":[
	{"status":"active cell","color":"#FF1010","timerange":[1,20]},
	{"status":"active cell","color":"#008302","timerange":[21,40]},
	{"status":"active cell","color":"#FF2EF3","timerange":[41,9000]},
	{"status":"active cell 2","color":"#FFBE2E","timerange":[41,9000]},
	{"status":"default","color":"white"}
],
"rules":[
{"ID":"left",
"applyTo":"default",
"neighbours":[{"rpos":[-1,-1],"status":"active cell"},{"rpos":[0,-1],"status":"default"},{"rpos":[1,-1],"status":"default"}],
"newstatus":"active cell"
},
{"ID":"right",
"applyTo":"default",
"neighbours":[{"rpos":[-1,-1],"status":"default"},{"rpos":[0,-1],"status":"default"},{"rpos":[1,-1],"status":"active cell"}],
"newstatus":"active cell"
},
{"ID":"center",
"applyTo":"default",
"neighbours":[{"rpos":[-1,-1],"status":"default"},{"rpos":[0,-1],"status":"active cell"},{"rpos":[1,-1],"status":"default"}],
"newstatus":"active cell"
},
{"ID":"center and left",
"applyTo":"default",
"neighbours":[{"rpos":[-1,-1],"status":"default"},{"rpos":[0,-1],"status":"active cell"},{"rpos":[1,-1],"status":"active cell"}],
"newstatus":"active cell"
}
]
}</pre>
<script src="src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    var editor = ace.edit("editor");
    //editor.setTheme("ace/theme/twilight");
    editor.getSession().setMode("ace/mode/json");
</script>

<script type="text/javascript">
if (typeof jQuery == 'undefined'){
	window.alert("can't see jQuery, do you have a connection?");
}

//this function will be called when the automa code changes
var compileRun=function(){
	var currentCode=ace.edit("editor").getSession().getValue();
	AONexecute(currentCode,automa,'#console');
	//ctx.fillText(ace.edit("editor").getSession().getValue(), 248, 43);
};

$(function(){
	var canvas = document.getElementById('target_canvas');
	//global variable to store the automata
	automa=new Automata(300,200);
	compileRun();
	if (canvas.getContext){
		//let's add a listener for editor content changes
		var editsession = ace.edit("editor").getSession().addEventListener('change',compileRun);
		//let's add canvas to show the automata status
		var running=false;
		var ciclicCall=function(){
				//$('#status').text("step number "+automa.steps+" last step changed "+automa.lastChanged+" cells, checking "+automa.lastTestedRules+" rules, cells are "+JSON.stringify(automa.cells)+" desc: "+automa.description);
				if(running)return;
				running=true;
				automa.step();
				document.title='Step '+automa.steps+' of JSON live automaton';
				automa.canvasDump(canvas);
				compileRun();
				running=false;
			};
		setInterval(ciclicCall,800);
	} else {
		alert("Canvas element not found. Are you using an old browser?");
	}
});
</script>
<span>The nice editor is based on the fantastic <a href="http://ace.ajax.org/">ACE editor</a>, using ASCII mode</span>
</body>
</html>
